SELECT
cik,
release_date AS 'date',
net_income AS 'ni',
operating_income AS 'opi',
gross_income AS 'gri',
revenue AS 'rev',
net_income_ext AS 'nix',
operating_income_ext AS 'opix',
gross_income_ext AS 'grix',
revenue_ext AS 'revx',
total_assets AS 'tass',
total_liabilities AS 'tlib',
current_assets AS 'cass',
current_liabilities AS 'clib',
operating_cash_flow AS 'oflow',
investing_cash_flow AS 'iflow',
financing_cash_flow AS 'fflow',
starting_cash AS 'scash',
ending_cash AS 'ecash'
FROM reports WHERE success = 1;



SELECT
cik,
release_date AS 'date',
net_income AS 'ni',
operating_income AS 'opi',
gross_income AS 'gri',
revenue AS 'rev',
total_assets AS 'tass',
total_liabilities AS 'tlib',
current_assets AS 'cass',
current_liabilities AS 'clib',
operating_cash_flow AS 'oflow',
investing_cash_flow AS 'iflow',
financing_cash_flow AS 'fflow',
starting_cash AS 'scash',
ending_cash AS 'ecash'
FROM reports WHERE success = 1;


SELECT cik,
TRUNCATE(margin*roe*debt_coverage*current_leverage*total_leverage, 1) AS score FROM (
	SELECT
	cik,
	release_date,
	TRUNCATE(net_income/revenue, 2) AS margin,
	TRUNCATE(net_income/(total_assets-total_liabilities), 2) AS roe,
	TRUNCATE(net_income/current_liabilities, 2) AS debt_coverage,
	TRUNCATE(current_assets/current_liabilities, 1) AS current_leverage,
	TRUNCATE(total_assets/total_liabilities, 1) AS total_leverage
	FROM reports
	WHERE release_date > '2017-11-01'
) data
WHERE margin BETWEEN 0 AND 1
AND debt_coverage > 1
AND current_leverage > 1
AND total_leverage > 1
ORDER BY score DESC;